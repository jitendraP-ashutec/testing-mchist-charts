<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha256-93wNFzm2GO3EoByj9rKZCwGjAJAwr0nujPaOgwUt8ZQ=" crossorigin="anonymous">


  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts-more.js"
    integrity="sha256-x5API4J/vECCB8CNZv5h5onmdQNrA7I2qvc35XE3QO0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/boost.js"
    integrity="sha256-CymzXFABoVZscOBGsQGzaIRHn/of09Xj2VuxPPeLPg8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/exporting.js"
    integrity="sha256-yr/VcTNtv0Q6nAc7jMKmx/mmwu/51GNIvTGqrLNm9so=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/offline-exporting.js"
    integrity="sha256-ctkyXnQruzgziWxhpoc/ebkzyZ3uiFAt7l0TRL3lrRk=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
    integrity="sha256-2JaAhvdQnfNMMnhWPauHOZ2k+dzftBmBjjownu3HC4g=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.2/dist/jquery.validate.min.js" integrity="sha256-+BEKmIvQ6IsL8sHcvidtDrNOdZO3C9LtFPtF2H0dOHI=" crossorigin="anonymous"></script>

  <script src="postoptions.js"></script>


  <style>
    .error {
      color: red;
    }
    .highcharts-legend-item {
      font-family: 'Open Sans,sans-serif';
      font-size: '1rem';
    }

    .highcharts-title {
      font-family: 'Open Sans,sans-serif';
    }

    .highcharts-subtitle {
      font-family: 'Open Sans,sans-serif';
    }

    .highcharts-axis-labels {
      font-family: 'Open Sans,sans-serif';
    }

    .highcharts-tooltip {
      font-family: 'Open Sans,sans-serif';
    }
  </style>

  <script>
    Highcharts.setOptions({
      lang: {
        thousandsSep: ','
      },
      credits: {
        enabled: false
      },
      colors: ['#2E93fA', '#66DA26', '#546E7A', '#E91E63', '#FF9800', '#00FFF5', '#9F00FF'],
      exporting: {
        enabled: true,
        scale: 5,
        buttons: {
          contextButton: {
            menuItems: ["downloadPNG", "downloadJPEG", "downloadPDF", "downloadSVG", "separator", "viewFullscreen", "printChart", 'downloadCSV', 'downloadXLS']
          }
        }
      }
    });

  </script>


</head>



<body>

  <div>

    <div style="margin: 10px;">
      <div class="row justify-content-center">

        <!---------------------------------------------------------------->
        <div class="col-sm-4">

          <div style="width:400px;height:500px;border-style: solid;">Form Here</div>

        </div>
        <!-- /End Contact Form Col -->
        <!---------------------------------------------------------------->


        <div class="col-sm-8">

          <div class="row">

            <div class="col">
              <form id="basic-form">
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="S0_input">Starting Account Size</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupPrepend">$</span>
                      </div>
                      <input minlength="3" onchange="runWorkers()" data-type='number' type="text" class="form-control" id="S0_input"
                        value="1,000,000" placeholder="Starting Account Size">
                    </div>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="Spending_input">Yearly Budget</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroupPrepend">$</span>
                      </div>
                      <input onchange="runWorkers()"  minlength="3" data-type='number' type="text" class="form-control"
                        id="Spending_input" value="40,000" placeholder="Yearly Budget">
                        <div class="input-group-append">
                          <span class="input-group-text" id="basic-addon2">per Year</span>
                        </div>
                    </div>
                  </div>
                </div>
              </form>

              <p id="histworkertext"></p>
              <p id="histscenariodesc"></p>
              <button class="btn btn-primary" onclick="zoominonworsthist()">Zoom in On Worst Years</button>
              <button class="btn btn-primary" onclick="zoominonworsthistreset()">Reset Zoom</button>
            </div>

            <div class="col">
              <figure class="highcharts-figure">
                <div id="container-histperc"></div>
              </figure>
            </div>

          </div>


          <figure class="highcharts-figure">
            <div id="container-histarea"></div>
          </figure>


        </div>
      </div>
    </div>
  </div>

  <script>

    ////////////////////////////////////////////////////////////////////////
    // POST Requests (https://workers.eadvisor.app/gethistdata/ is called the Historical & https://workers.eadvisor.app/getmcdata/ is called simulation or Monte Carlo)
    function runWorkers() {
      // Getting Values from Inputs & Removing ,
      var S0input = document.getElementById("S0_input").value.replace(/,/g, "");
      var Spendinginput = document.getElementById("Spending_input").value.replace(/,/g, "");

      // Setting Values from Inputs in POST Request
      postoptions.S0_tas = Number(S0input);
      postoptions.annualwithdrawalneeds = Number(Spendinginput);
      postoptions.annualretirementwithdrawalneeds = Number(Spendinginput);

      //If it is checked.
      var settingsHIST = {
        "url": "https://workers.eadvisor.app/gethistdata/",
        "method": "POST",
        "timeout": 0,
        crossDomain: true,
        "headers": {
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*"
        },
        "data": JSON.stringify(postoptions),
      };


      $.ajax(settingsHIST).done(function (response) {
        updateHISTCharts(response);
      });


    }


    ////////////////////////////////////////////////////////////////
    // Updating Charts based on POST Results

    var HISTArea_chart_zoomonworst = 1000000;
    var HISTArea_chart_max = 1000000;

    function updateHISTCharts(response) {
      // P Alive Chart (see histperc.js for full chart definition)
      var palive_hist_val = Number(response.palive);
      if (palive_hist_val < 90) { palive_hist_val = Math.round(palive_hist_val); }

      let gaugecolorval = perc2color(palive_hist_val, minokperc, 100, "FF");

      HISTPAlive.update({
        title: {
          text: '<h2>' + palive_hist_val + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_hist_val],
            ['', 100 - palive_hist_val]

          ]
        }]

      });

      // Area Chart (see histarea.js for full chart definition)
      //Create Highcharts compatible data
      let xval = getXVALArray(response.averageresult.length);
      var chart_averageresult = transposefnc(toMatrix(xval.concat(response.averageresult), xval.length));
      var chart_worst = transposefnc(toMatrix(xval.concat(response.worstresult_1st), xval.length));
      var chart_2ndworst = transposefnc(toMatrix(xval.concat(response.worstresult_2nd), xval.length));
      var chart_3rdworst = transposefnc(toMatrix(xval.concat(response.worstresult_3rd), xval.length));
      var chart_best = transposefnc(toMatrix(xval.concat(response.bestresult_1st), xval.length));
      var chart_2ndbest = transposefnc(toMatrix(xval.concat(response.bestresult_2nd), xval.length));
      var chart_3rdbest = transposefnc(toMatrix(xval.concat(response.bestresult_3rd), xval.length));

      HISTArea_chart_max = getMaxOfArray(response.bestresult_1st);
      var HISTArea_chart_min = getMinOfArray(response.worstresult_1st);
      if (HISTArea_chart_min < 0) { HISTArea_chart_min = 0; }

      HISTArea_chart_zoomonworst = getMaxOfArray(response.worstresult_3rd);

      HISTArea.update({
        yAxis: {
          min: HISTArea_chart_min,
          max: HISTArea_chart_max
        },
        series: [{
          name: 'Worst Year (' + response.date_worstresult_1st + ')',
          data: chart_worst // worst
        }, {
          name: '2nd Worst Year (' + response.date_worstresult_2nd + ')',
          data: chart_2ndworst // 2nd worst
        },
        {
          name: '3rd Worst Year (' + response.date_worstresult_3rd + ')',
          data: chart_3rdworst // 3rd worst
        }, {
          name: 'Best Year (' + response.date_bestresult_1st + ')',
          data: chart_best //  best
        }, {
          name: '2nd Best Year (' + response.date_bestresult_2nd + ')',
          data: chart_2ndbest // 2nd best
        },
        {
          name: '3rd Best Year (' + response.date_bestresult_3rd + ')',
          data: chart_3rdbest // 3rd best
        }, {
          data: chart_averageresult // Average
        }]
      });

      // Text from HIST Worker
      document.getElementById("histworkertext").innerHTML = response.description_text;

      // Scenario Description from HIST Worker
      document.getElementById("histscenariodesc").innerHTML = response.scenario_text;

    }

    function zoominonworsthist() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_zoomonworst
        }
      })
    };

    function zoominonworsthistreset() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_max
        }
      })
    };


  </script>

  <script src="histarea.js"></script>
  <script src="histperc.js"></script>

</body>

<footer>
  <script>
    function parseJSAtOnload1() {
      var element = document.createElement("script");
      element.src = "https://www.google.com/recaptcha/api.js";
      document.body.appendChild(element);
    }

    if (window.addEventListener) { window.addEventListener("load", parseJSAtOnload1, false); }
    else if (window.attachEvent) { window.attachEvent("onload", parseJSAtOnload1); }
    else { window.onload = parseJSAtOnload1; }


    $(document).ready(function () {
      $("input[data-type='number']").keyup(function (event) {
        // skip for arrow keys
        if (event.which >= 37 && event.which <= 40) {
          event.preventDefault();
        }
        var $this = $(this);
        var num = $this.val().replace(/,/gi, "");
        var num2 = num.split(/(?=(?:\d{3})+$)/).join(",");

        $this.val(num2);
      });

      $("#basic-form").validate();
    });


    // Initiitalize the Worker & Run the 1st Time
    runWorkers();
  </script>

</footer>


</html>