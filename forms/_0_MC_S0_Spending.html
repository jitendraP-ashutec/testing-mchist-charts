<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha256-93wNFzm2GO3EoByj9rKZCwGjAJAwr0nujPaOgwUt8ZQ=" crossorigin="anonymous">
  
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts-more.js"
    integrity="sha256-x5API4J/vECCB8CNZv5h5onmdQNrA7I2qvc35XE3QO0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/boost.js"
    integrity="sha256-CymzXFABoVZscOBGsQGzaIRHn/of09Xj2VuxPPeLPg8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/exporting.js"
    integrity="sha256-yr/VcTNtv0Q6nAc7jMKmx/mmwu/51GNIvTGqrLNm9so=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/offline-exporting.js" integrity="sha256-ctkyXnQruzgziWxhpoc/ebkzyZ3uiFAt7l0TRL3lrRk=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<style>
  .highcharts-legend-item {
    font-family: 'Open Sans,sans-serif';
    font-size: '1rem';
  }
  .highcharts-title {
    font-family: 'Open Sans,sans-serif';
  }
  .highcharts-subtitle {
    font-family: 'Open Sans,sans-serif';
  }
  .highcharts-axis-labels {
    font-family: 'Open Sans,sans-serif';
  }
  .highcharts-tooltip {
    font-family: 'Open Sans,sans-serif';
  }
</style>
  <!-- These are some inputs to the POST command to the function, these will come from the Database -->
  <script>
    Highcharts.setOptions({
      lang: {
        thousandsSep: ','
      },
      credits: {
        enabled: false
      },
      colors: ['#2E93fA', '#66DA26', '#546E7A', '#E91E63', '#FF9800', '#00FFF5', '#9F00FF'],
      exporting: {
          enabled: true,
          scale: 5,
          buttons: {
              contextButton: {
                  menuItems: ["downloadPNG", "downloadJPEG", "downloadPDF", "downloadSVG", "separator", "viewFullscreen", "printChart", 'downloadCSV', 'downloadXLS']
              }
          }
      }
    });

    var minokperc = 70;


    var preretire_stockallocation = 70;
    var preretire_tbondallocation = 10;
    var preretire_corpbondallocation = 20;
    var preretire_cashallocation = 0;

    var retire_stockallocation = 50;
    var retire_tbondallocation = 20;
    var retire_corpbondallocation = 20;
    var retire_cashallocation = 10;

    var age_to_start_adjust_pa = 70;
    var age_to_end_adjust_pa = 80;

    var client_birthmonth = 7;
    var client_birthday = 22;
    var client_birthyear = 1960;
    var coclient_birthmonth = 7;
    var coclient_birthday = 22;
    var coclient_birthyear = 1960;

    var maxagetoplan = 95;

    var coclient_selected = true;

  </script>


</head>



<body>

  <hr>
  <div>

    <div style="margin: 10px;">
      <div class="row justify-content-center">

        <!---------------------------------------------------------------->
        <div class="col-sm-4">
          
          <div style="width:400px;height:500px;border-style: solid;">Form Here</div>

        </div>
        <!-- /End Contact Form Col -->
        <!---------------------------------------------------------------->


        <div class="col-sm-8">

        <div class="row">
          <div class="col">


            <label for="S0_input">Starting Account Size</label>
            <input
                type="text"
                data-type="number"
                class="form-control"
                name="S0_input"
                id="S0_input"
                placeholder="Starting Account Size"
                onchange="runWorkers()"
              />
            <label for="Spending_input">Yearly Budget</label>
            <input
                type="text"
                data-type="number"
                class="form-control"
                name="Spending_input"
                id="Spending_input"
                placeholder="Yearly Budget"
                onchange="runWorkers()"
              />
          </div>
          <div class="col">
            <figure class="highcharts-figure">
              <div id="container-histperc"></div>
            </figure>
          </div>
        </div>

          <figure class="highcharts-figure">
            <div id="container-histarea"></div>
          </figure>

          <button onclick="zoominonworsthist()">Zoom in On Worst Years</button>
          <button onclick="zoominonworsthistreset()">Reset Zoom</button>

          
        </div>
      </div>
    </div>

  </div>



  <hr>
  <figure class="highcharts-figure">
    <div id="container-mcarea"></div>
  </figure>

  <hr>
  <figure class="highcharts-figure">
    <div id="container-mcperc"></div>
  </figure>



  <hr>
  <figure class="highcharts-figure">
    <div id="palivechart"></div>
  </figure>

  <hr>
  <figure class="highcharts-figure">
    <div id="histyearlyspendingchart"></div>
  </figure>

  <hr>
  <figure class="highcharts-figure">
    <div id="mcyearlyspendingchart"></div>
  </figure>


  <hr>
  <div style="width: 100%; display: table;">
    <p>Chart 500: % Allocation Chart & Chart 501 Glide Path [Note: to be displayed on the dashboard in accordian & on the cleint information entry on the Investment section]</p>
    <p>Highchart options defined in: glidepath.js for the Area Chart & percentallocations.js for the pie charts (starting: var percallocation_preretire & ending: var percallocation_retire)</p>
    <div style="display: table-row"></div>
      <div style="width: 30%; display: table-cell;">
        <figure class="highcharts-figure">
          <div id="percallocations-preretire"></div>
        </figure>
      </div>
      <div style="width: 30%; display: table-cell;">
        <figure class="highcharts-figure">
          <div id="percallocations-retire"></div>
        </figure>
      </div>
      <div style="display: table-cell;">
        <figure class="highcharts-figure">
          
          <div id="container-glidechart"></div>
        </figure>
    </div> 
   </div>
  </div>



<hr>
<hr>
<hr>
<h2>This is the Card: Simulation Text Description</h2>
<p id="mcworkertext"></p>

<hr>
<h2>This is the Card: Historical Text Description</h2>
<p id="histworkertext"></p>

<hr>
<h2>This is the Card: Financial Overview Text Description</h2>
<p id="financialoverviewtext"></p>

<hr>
<h2>This is the Card: Investment Overview Text Description</h2>
<p id="investmentoverviewtext"></p>

<hr>
<h2>This is the Card on Scenario Tab to describe the scenario being run</h2>
<p id="mcscenariodesc"></p>

<hr>
<h2>This is the Card on Historical Tab to describe the scenario being run</h2>
<p id="histscenariodesc"></p>

<hr>
<hr>
<h2>(Displayed on Social Security Overview Client Entry Area & Dashboard) Social Security Overview Text:</h2>
<p id="socialsecurityoverviewtext"></p>
<h2>(Not Displayed) Social Security Percentage of Full:</h2>
<p id="socialsecuritypercoffull"></p>
<h2>(Not Displayed) Social Security Percentage of Full (Widow):</h2>
<p id="socialsecuritypercoffullwidow"></p>


<!--/////////////////////////////////////////////////////////////////////////////////////////////-->

  <script src="functions.for.frontend.js"></script>
  <script src="histarea.js"></script>
  <script src="histperc.js"></script>
  <script src="mcarea.js"></script>
  <script src="mcperc.js"></script>
  <script src="mcpalivearea.js"></script>
  <script src="spendingchart.js"></script>
  <script src="postoptions.js"></script>
  <script src="getoptions.js"></script>
  <script src="glidepath.js"></script>
  <script src="percentallocations.js"></script>

  <script>

    ////////////////////////////////////////////////////////////////////////
    // POST Requests (https://workers.eadvisor.app/gethistdata/ is called the Historical & https://workers.eadvisor.app/getmcdata/ is called simulation or Monte Carlo)
    function runWorkers(x) {
      //If it is checked.
        var settingsHIST_scenarios = {
          "url": "https://workers.eadvisor.app/gethistdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions),
        };

        var settingsMC_scenarios = {
          "url": "https://workers.eadvisor.app/getmcdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions),
        };

        $.ajax(settingsHIST_scenarios).done(function (response) {
          updateHISTCharts(response);
        });

        $.ajax(settingsMC_scenarios).done(function (response) {
          updateMCCharts(response);
        });



      // GET Request to Overview function
      // Request sent to https://widgets.eadvisor.app/getoverview/ with parameters shown below
      $.getJSON( "https://widgets.eadvisor.app/getoverview/", getoptionsforoverview,
      function(data) {
        updateOverviewData(data);
      })
      .fail(function() {
        console.log( "error in get request to .../getoverview/" );
      });


    }


    ////////////////////////////////////////////////////////////////
    // Updating Charts based on POST Results

    function updateMCCharts(response) {
      console.log(response);

      // P Alive Chart (see mcperc.js for full chart definition)
      var palive_mc_val = Number(response.palive);
      if (palive_mc_val < 90) { palive_mc_val = Math.round(palive_mc_val); }

      let gaugecolorval = perc2color(palive_mc_val, minokperc, 100, "FF");
      console.log(gaugecolorval)
      MCPAlive.update({
        title: {
          text: '<h2>' + palive_mc_val + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_mc_val],
            ['', 100 - palive_mc_val]

          ]
        }]

      });
      // Legacy P Alive %
      var palive_mc_val_legacy = Number(response.palive_legacy);
      if (palive_mc_val_legacy < 90) { palive_mc_val = Math.round(palive_mc_val_legacy); }

      gaugecolorval = perc2color(palive_mc_val_legacy, minokperc, 100, "FF");

      MCPAliveLegacy.update({
        title: {
          text: '<h2>' + palive_mc_val_legacy + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_mc_val_legacy],
            ['', 100 - palive_mc_val_legacy]

          ]
        }]

      });

      // MC Area Chart (see mcarea.js for definition)

      //Create Highcharts compatible data
      let xval = getXVALArray(response.q10.length);
      q10q90 = transposefnc(toMatrix(xval.concat(response.q10).concat(response.q90), xval.length));
      q25q75 = transposefnc(toMatrix(xval.concat(response.q25).concat(response.q75), xval.length));
      q50 = transposefnc(toMatrix(xval.concat(response.q50), xval.length));

      var MCArea_chart_max = getMaxOfArray(response.q75);
      var MCArea_chart_min = getMinOfArray(response.q10);
      if (MCArea_chart_min < 0) { MCArea_chart_min = 0; }

      MCArea.update({
        yAxis: {
          min: MCArea_chart_min,
          max: MCArea_chart_max
        },
        series: [
          {
            data: q50 // Average
          },
          {
            data: q25q75 // 25-75%
          },
          {
            data: q10q90 // 10-90%
          }]

      });

      // MC P Alive Chart (see mcpalivearea.js for definition)
      MCPAliveArea.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.palive_chart
        }]
      });

      // Spending & Witdhrawal Chart (see spendingchart.js for definitions)
      const withdrawlratecalculated = divide2Arrays(response.spending, response.q50).map(x => x * 100);

      MCSpending.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.spending, // Net Spending/Income
        }, {
          data: withdrawlratecalculated, // Withdrawal Rate
        }]
      });


      // Description from MC Worker
      document.getElementById("mcworkertext").innerHTML = response.description_text;

      // Scenario Description from MC Worker
      document.getElementById("mcscenariodesc").innerHTML = response.scenario_text;
    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////////

    var HISTArea_chart_zoomonworst = 1000000;
    var HISTArea_chart_max = 1000000;

    function updateHISTCharts(response) {
      console.log(response);


      // P Alive Chart (see histperc.js for full chart definition)
      console.log(response.palive);
      var palive_hist_val = Number(response.palive);
      if (palive_hist_val < 90) { palive_hist_val = Math.round(palive_hist_val); }

      let gaugecolorval = perc2color(palive_hist_val, minokperc, 100, "FF");

      HISTPAlive.update({
        title: {
          text: '<h2>' + palive_hist_val + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_hist_val],
            ['', 100 - palive_hist_val]

          ]
        }]

      });
      // Legacy P Alive %
      var palive_hist_val_legacy = Number(response.palive_legacy);
      if (palive_hist_val_legacy < 90) { palive_hist_val = Math.round(palive_hist_val_legacy); }

      gaugecolorval = perc2color(palive_hist_val_legacy, minokperc, 100, "FF");

      HISTPAliveLegacy.update({
        title: {
          text: '<h2>' + palive_hist_val_legacy + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_hist_val_legacy],
            ['', 100 - palive_hist_val_legacy]

          ]
        }]

      });

      // Area Chart (see histarea.js for full chart definition)
      //Create Highcharts compatible data
      let xval = getXVALArray(response.averageresult.length);
      var chart_averageresult = transposefnc(toMatrix(xval.concat(response.averageresult), xval.length));
      var chart_worst = transposefnc(toMatrix(xval.concat(response.worstresult_1st), xval.length));
      var chart_2ndworst = transposefnc(toMatrix(xval.concat(response.worstresult_2nd), xval.length));
      var chart_3rdworst = transposefnc(toMatrix(xval.concat(response.worstresult_3rd), xval.length));
      var chart_best = transposefnc(toMatrix(xval.concat(response.bestresult_1st), xval.length));
      var chart_2ndbest = transposefnc(toMatrix(xval.concat(response.bestresult_2nd), xval.length));
      var chart_3rdbest = transposefnc(toMatrix(xval.concat(response.bestresult_3rd), xval.length));

      HISTArea_chart_max = getMaxOfArray(response.bestresult_1st);
      var HISTArea_chart_min = getMinOfArray(response.worstresult_1st);
      if (HISTArea_chart_min < 0) { HISTArea_chart_min = 0; }

      HISTArea_chart_zoomonworst = getMaxOfArray(response.worstresult_3rd);

      HISTArea.update({
        yAxis: {
          min: HISTArea_chart_min,
          max: HISTArea_chart_max
        },
        series: [{
          name: 'Worst Year (' + response.date_worstresult_1st + ')',
          data: chart_worst // worst
        }, {
          name: '2nd Worst Year (' + response.date_worstresult_2nd + ')',
          data: chart_2ndworst // 2nd worst
        },
        {
          name: '3rd Worst Year (' + response.date_worstresult_3rd + ')',
          data: chart_3rdworst // 3rd worst
        }, {
          name: 'Best Year (' + response.date_bestresult_1st + ')',
          data: chart_best //  best
        }, {
          name: '2nd Best Year (' + response.date_bestresult_2nd + ')',
          data: chart_2ndbest // 2nd best
        },
        {
          name: '3rd Best Year (' + response.date_bestresult_3rd + ')',
          data: chart_3rdbest // 3rd best
        }, {
          data: chart_averageresult // Average
        }]
      });


      // Spending & Witdhrawal Chart (see spendingchart.js for definitions)
      const withdrawlratecalculated = divide2Arrays(response.spending, response.averageresult).map(x => x * 100);

      HISTSpending.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.spending, // Net Spending/Income
        }, {
          data: withdrawlratecalculated, // Withdrawal Rate
        }]
      });

      // Text from HIST Worker
      document.getElementById("histworkertext").innerHTML = response.description_text;

      // Scenario Description from HIST Worker
      document.getElementById("histscenariodesc").innerHTML = response.scenario_text;

    }

    function zoominonworsthist() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_zoomonworst
        }
      })
    };

    function zoominonworsthistreset() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_max
        }
      })
    };


    ///////////////////////////////////////////////////////////////////////////////////////////////////////////
    // GET Request for overview function: https://widgets.eadvisor.app/getoverview/
    function updateOverviewData(response) {
      console.log(response);
      

      // Financial overview HTML text
      document.getElementById("financialoverviewtext").innerHTML = response.financial_overview;

      // Investment overview HTML text
      document.getElementById("investmentoverviewtext").innerHTML = response.investment_overview;

      // Social Security overview HTML text
      document.getElementById("socialsecurityoverviewtext").innerHTML = response.social_security_desc;

      // Social Security % of Full #
      document.getElementById("socialsecuritypercoffull").innerHTML = "For Client: " + response.social_security_percent_client + " for co-client: " + response.social_security_percent_coclient;

      // Social Security % of Full for Widow #
      document.getElementById("socialsecuritypercoffullwidow").innerHTML = "For Client: " + response.social_security_percentwidow_client + " for co-client: " + response.social_security_percentwidow_coclient;


      // Percent Allocations (Pre-Retire Graph)
      percallocation_preretire.update({
          subtitle: {
              text: response.startportadjust
          },
        series: [{
        data: [{
            y: response.percent_allocations_preretire[0] // Stock
        }, {
            y: response.percent_allocations_preretire[1] // T Bond
        }, {
            y: response.percent_allocations_preretire[2] // Corp Bond
        }, {
            y: response.percent_allocations_preretire[3] // Cash
        }]
      }]

      });

      // Percent Allocations (Retire Graph)
      percallocation_retire.update({
          subtitle: {
              text: response.endportadjust
          },
          series: [{
          data: [{
              y: response.percent_allocations_retire[0] // Stock
          }, {
              y: response.percent_allocations_retire[1] // T Bond
          }, {
              y: response.percent_allocations_retire[2] // Corp Bond
          }, {
              y: response.percent_allocations_retire[3] // Cash
          }]
      }]

      });

      // Glide Path (chart 501) - percent allocation mapping
      glidpathchart.update({
          xAxis: {
            categories: response.investment_map.xval // Years (X Axis)
          },
          series: [{
          data: response.investment_map.stockpath // Stocks
          }, {
              data: response.investment_map.tbondpath  // Treasury Bonds
          }, {
            data: response.investment_map.corpbondpath  // Corporate Bonds
          }, {
            data: response.investment_map.cashpath  // Cash
          }]
      });


    }


  </script>

</body>

<footer>
    <script>
        function parseJSAtOnload1() {
        var element = document.createElement("script");
        element.src = "https://www.google.com/recaptcha/api.js";
        document.body.appendChild(element);
        }

        if (window.addEventListener)
        {window.addEventListener("load", parseJSAtOnload1, false);}
        else if (window.attachEvent)
        {window.attachEvent("onload", parseJSAtOnload1);}
        else {window.onload = parseJSAtOnload1;}


        $(document).ready(function(){
          $("input[data-type='number']").keyup(function(event){
            // skip for arrow keys
            if(event.which >= 37 && event.which <= 40){
                event.preventDefault();
            }
            var $this = $(this);
            var num = $this.val().replace(/,/gi, "");
            var num2 = num.split(/(?=(?:\d{3})+$)/).join(",");
 
            $this.val(num2);
        });
      });
    </script>

</footer>


</html>