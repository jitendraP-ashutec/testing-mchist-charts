<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/highcharts-more.js"
    integrity="sha256-x5API4J/vECCB8CNZv5h5onmdQNrA7I2qvc35XE3QO0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/boost.js"
    integrity="sha256-CymzXFABoVZscOBGsQGzaIRHn/of09Xj2VuxPPeLPg8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/highcharts@8.2.0/modules/exporting.js"
    integrity="sha256-yr/VcTNtv0Q6nAc7jMKmx/mmwu/51GNIvTGqrLNm9so=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="generate.lead.url.js"></script>

  <!-- These are some inputs to the POST command to the function, these will come from the Database -->
  <script>
    var minokperc = 70;


    var preretire_stockallocation = 70;
    var preretire_tbondallocation = 10;
    var preretire_corpbondallocation = 20;
    var preretire_cashallocation = 0;

    var retire_stockallocation = 50;
    var retire_tbondallocation = 20;
    var retire_corpbondallocation = 20;
    var retire_cashallocation = 10;

    var age_to_start_adjust_port_allocations = 70;
    var age_to_end_adjust_port_allocations = 80;

    var client_birthmonth = 7;
    var client_birthday = 22;
    var client_birthyear = 1960;
    var coclient_birthmonth = 7;
    var coclient_birthday = 22;
    var coclient_birthyear = 1960;

    var maxagetoplan = 95;

    var coclient_selected = true;

  </script>

</head>



<body>
  <input type="checkbox" id="sim_scenarios" value="1" oninput="runWorkers(this)" />Run Scenario POST Request



  <hr>
  <figure class="highcharts-figure">
    <p>Chart 501: Glidepath</p>
    <div id="container-glidechart"></div>
  </figure>
  <hr>
  <figure class="highcharts-figure">
    <p>Chart 200: Historical Area / When a scenario runs (checkbox at top) this is Chart 203</p>
    <div id="container-histarea"></div>
  </figure>
  <button onclick="zoominonworsthist()">Zoom in On Worst Years</button>
  <button onclick="zoominonworsthistreset()">Zoom on All Years</button>

  <hr>
  <figure class="highcharts-figure">
    <p>Chart 100: Monte Carlo Area / When a scenario runs (checkbox at top) this is Chart 103</p>
    <div id="container-mcarea"></div>
  </figure>

  <hr>
  <div style="width: 100%; display: table;">
    <div style="display: table-row">
      <div style="width: 600px; display: table-cell;">
        <figure class="highcharts-figure">
          <p>Chart 101: Monte Carlo Percent / When a scenario runs (checkbox at top) this is Chart 104</p>
          <div id="container-mcperc"></div>
        </figure>
      </div>
      <div style="display: table-cell;">
        <figure class="highcharts-figure">
          <p>Chart 102: Monte Carlo Legacy Percent / When a scenario runs (checkbox at top) this is Chart 105</p>
          <div id="container-mcperc-legacy"></div>
        </figure>
      </div>
    </div>
  </div>

  <hr>
  <div style="width: 100%; display: table;">
    <div style="display: table-row">
      <div style="width: 600px; display: table-cell;">
        <figure class="highcharts-figure">
          <p>Chart 201: Historical Percent / When a scenario runs (checkbox at top) this is Chart 204</p>
          <div id="container-histperc"></div>
        </figure>
      </div>
      <div style="display: table-cell;">
        <figure class="highcharts-figure">
          <p>Chart 202: Historical Legacy Percent / When a scenario runs (checkbox at top) this is Chart 205</p>
          <div id="container-histperc-legacy"></div>
        </figure>
      </div>
    </div>
  </div>


  <hr>
  <figure class="highcharts-figure">
    <p>Chart xxx: P Alive Area</p>
    <div id="palivechart"></div>
  </figure>

  <hr>
  <figure class="highcharts-figure">
    <p>Chart xxx: Historical Spending Chart [this chart is not on the documents, but I may want to add it...]</p>
    <div id="histyearlyspendingchart"></div>
  </figure>

  <hr>
  <figure class="highcharts-figure">
    <p>Chart xxx: Monte Carlo Spending Chart [this chart is not on the documents, but I may want to add it...]</p>
    <div id="mcyearlyspendingchart"></div>
  </figure>


  <hr>
  <div style="width: 100%; display: table;">
    <p>Chart 500: % Allocation Chart</p>
    <div style="display: table-row">
      <div style="width: 600px; display: table-cell;">
        <figure class="highcharts-figure">
          <div id="percallocations-preretire"></div>
        </figure>
      </div>
      <div style="display: table-cell;">
        <figure class="highcharts-figure">
          <div id="percallocations-retire"></div>
        </figure>
      </div>
    </div>
  </div>


  <hr>
  <h2>Below is the contents of the Marketing Tab</h2>
  <p>This is the embed code they will be able to copy, this embed code is also live updating in the main box titled 'Live Form & Lead Generation Tool Rendered Here'</p>
  <!--<p id="leadurloutputelement"></p>-->
  <xmp id="leadurloutputelement1" style='padding:0px;margin:0px;white-space:nowrap'></xmp>
  <script>
    var leadurl_output = getLeadEmbedCode("joshua.c.terrell@gmail.com", 0, 1); //1st field is email address they enter, 2nd field is a number corresponding to the lead form they select in the dropdown, 3rd field is the enable/disable form checkbox
    
    console.log(leadurl_output);
    //document.getElementById("leadurloutputelement").innerHTML = leadurl_output;
    document.getElementById("leadurloutputelement1").innerHTML = leadurl_output;
  </script>

<hr>
<hr>
<hr>
<h2>This is the Card: Simulation Text Description</h2>
<p id="mcworkertext"></p>

<hr>
<h2>This is the Card: Historical Text Description</h2>
<p id="histworkertext"></p>

<hr>
<h2>This is the Card: Financial Overview Text Description</h2>
<p id="financialoverviewtext"></p>

<hr>
<h2>This is the Card: Investment Overview Text Description</h2>
<p id="investmentoverviewtext"></p>


<!--/////////////////////////////////////////////////////////////////////////////////////////////-->

  <script src="functions.for.frontend.js"></script>
  <script src="histarea.js"></script>
  <script src="histperc.js"></script>
  <script src="mcarea.js"></script>
  <script src="mcperc.js"></script>
  <script src="mcpalivearea.js"></script>
  <script src="spendingchart.js"></script>
  <script src="postoptions.js"></script>
  <script src="postoptions_scenarios.js"></script>

  <script>

    ////////////////////////////////////////////////////////////////////////
    // POST Requests (https://widgets.eadvisor.app/gethistdata/ is called the Historical & https://widgets.eadvisor.app/getmcdata/ is called simulation or Monte Carlo)
    function runWorkers(checkbox) {
      //If it is checked.
      if (checkbox.checked) {
        var settingsHIST_scenarios = {
          "url": "https://widgets.eadvisor.app/gethistdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions_scenarios),
        };

        var settingsMC_scenarios = {
          "url": "https://widgets.eadvisor.app/getmcdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions_scenarios),
        };

        $.ajax(settingsHIST_scenarios).done(function (response) {
          updateHISTCharts(response);
        });

        $.ajax(settingsMC_scenarios).done(function (response) {
          updateMCCharts(response);
        });
      }
      //If it has been unchecked.
      else {
        var settingsHIST = {
          "url": "https://widgets.eadvisor.app/gethistdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions),
        };

        var settingsMC = {
          "url": "https://widgets.eadvisor.app/getmcdata/",
          "method": "POST",
          "timeout": 0,
          crossDomain: true,
          "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
          },
          "data": JSON.stringify(postoptions),
        };

        $.ajax(settingsHIST).done(function (response) {
          updateHISTCharts(response);
        });

        $.ajax(settingsMC).done(function (response) {
          updateMCCharts(response);
        });

      }
    }


    ////////////////////////////////////////////////////////////////
    // Updating Charts based on POST Results

    function updateMCCharts(response) {
      console.log(response);

      // P Alive Chart (see mcperc.js for full chart definition)
      var palive_mc_val = Number(response.palive);
      if (palive_mc_val < 90) { palive_mc_val = Math.round(palive_mc_val); }

      let gaugecolorval = perc2color(palive_mc_val, minokperc, 100, "FF");
      console.log(gaugecolorval)
      MCPAlive.update({
        title: {
          text: '<h2>' + palive_mc_val + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_mc_val],
            ['', 100 - palive_mc_val]

          ]
        }]

      });
      // Legacy P Alive %
      var palive_mc_val_legacy = Number(response.palive_legacy);
      if (palive_mc_val_legacy < 90) { palive_mc_val = Math.round(palive_mc_val_legacy); }

      gaugecolorval = perc2color(palive_mc_val_legacy, minokperc, 100, "FF");

      MCPAliveLegacy.update({
        title: {
          text: '<h2>' + palive_mc_val_legacy + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_mc_val_legacy],
            ['', 100 - palive_mc_val_legacy]

          ]
        }]

      });

      // MC Area Chart (see mcarea.js for definition)

      //Create Highcharts compatible data
      let xval = getXVALArray(response.q10.length);
      q10q90 = transposefnc(toMatrix(xval.concat(response.q10).concat(response.q90), xval.length));
      q25q75 = transposefnc(toMatrix(xval.concat(response.q25).concat(response.q75), xval.length));
      q50 = transposefnc(toMatrix(xval.concat(response.q50), xval.length));

      var MCArea_chart_max = getMaxOfArray(response.q75);
      var MCArea_chart_min = getMinOfArray(response.q10);
      if (MCArea_chart_min < 0) { MCArea_chart_min = 0; }

      MCArea.update({
        yAxis: {
          min: MCArea_chart_min,
          max: MCArea_chart_max
        },
        series: [
          {
            data: q50 // Average
          },
          {
            data: q25q75 // 25-75%
          },
          {
            data: q10q90 // 10-90%
          }]

      });

      // MC P Alive Chart (see mcpalivearea.js for definition)
      MCPAliveArea.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.palive_chart
        }]
      });

      // Spending & Witdhrawal Chart (see spendingchart.js for definitions)
      const withdrawlratecalculated = divide2Arrays(response.spending, response.q50).map(x => x * 100);

      MCSpending.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.spending, // Net Spending/Income
        }, {
          data: withdrawlratecalculated, // Withdrawal Rate
        }]
      });


      // Text from MC Worker
      document.getElementById("mcworkertext").innerHTML = response.description_text;


    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////////

    var HISTArea_chart_zoomonworst = 1000000;
    var HISTArea_chart_max = 1000000;

    function updateHISTCharts(response) {
      console.log(response);


      // P Alive Chart (see histperc.js for full chart definition)
      console.log(response.palive);
      var palive_hist_val = Number(response.palive);
      if (palive_hist_val < 90) { palive_hist_val = Math.round(palive_hist_val); }

      let gaugecolorval = perc2color(palive_hist_val, minokperc, 100, "FF");

      HISTPAlive.update({
        title: {
          text: '<h2>' + palive_hist_val + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_hist_val],
            ['', 100 - palive_hist_val]

          ]
        }]

      });
      // Legacy P Alive %
      var palive_hist_val_legacy = Number(response.palive_legacy);
      if (palive_hist_val_legacy < 90) { palive_hist_val = Math.round(palive_hist_val_legacy); }

      gaugecolorval = perc2color(palive_hist_val_legacy, minokperc, 100, "FF");

      HISTPAliveLegacy.update({
        title: {
          text: '<h2>' + palive_hist_val_legacy + '%</h2>'
        },
        plotOptions: {
          pie: {
            colors: [gaugecolorval, "#ffffff"]
          }
        },
        series: [{
          data: [
            ['', palive_hist_val_legacy],
            ['', 100 - palive_hist_val_legacy]

          ]
        }]

      });

      // Area Chart (see histarea.js for full chart definition)
      //Create Highcharts compatible data
      let xval = getXVALArray(response.averageresult.length);
      var chart_averageresult = transposefnc(toMatrix(xval.concat(response.averageresult), xval.length));
      var chart_worst = transposefnc(toMatrix(xval.concat(response.worstresult_1st), xval.length));
      var chart_2ndworst = transposefnc(toMatrix(xval.concat(response.worstresult_2nd), xval.length));
      var chart_3rdworst = transposefnc(toMatrix(xval.concat(response.worstresult_3rd), xval.length));
      var chart_best = transposefnc(toMatrix(xval.concat(response.bestresult_1st), xval.length));
      var chart_2ndbest = transposefnc(toMatrix(xval.concat(response.bestresult_2nd), xval.length));
      var chart_3rdbest = transposefnc(toMatrix(xval.concat(response.bestresult_3rd), xval.length));

      HISTArea_chart_max = getMaxOfArray(response.bestresult_1st);
      var HISTArea_chart_min = getMinOfArray(response.worstresult_1st);
      if (HISTArea_chart_min < 0) { HISTArea_chart_min = 0; }

      HISTArea_chart_zoomonworst = getMaxOfArray(response.worstresult_3rd);

      HISTArea.update({
        yAxis: {
          min: HISTArea_chart_min,
          max: HISTArea_chart_max
        },
        series: [{
          data: chart_worst // worst
        }, {
          data: chart_2ndworst // 2nd worst
        },
        {
          data: chart_3rdworst // 3rd worst
        }, {
          data: chart_best //  best
        }, {
          data: chart_2ndbest // 2nd best
        },
        {
          data: chart_3rdbest // 3rd best
        }, {
          data: chart_averageresult // Average
        }]
      });


      // Spending & Witdhrawal Chart (see spendingchart.js for definitions)
      const withdrawlratecalculated = divide2Arrays(response.spending, response.averageresult).map(x => x * 100);

      HISTSpending.update({
        xAxis: {
          categories: xval
        },
        series: [{
          data: response.spending, // Net Spending/Income
        }, {
          data: withdrawlratecalculated, // Withdrawal Rate
        }]
      });

      // Text from HIST Worker
      document.getElementById("histworkertext").innerHTML = response.description_text;


      // Financial overview data from HIST Worker
      document.getElementById("financialoverviewtext").innerHTML = response.finoverview_text;

      // Investment overview data from HIST Worker
      document.getElementById("investmentoverviewtext").innerHTML = response.investoverview_text;

    }

    function zoominonworsthist() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_zoomonworst
        }
      })
    };

    function zoominonworsthistreset() {
      HISTArea.update({
        yAxis: {
          max: HISTArea_chart_max
        }
      })
    };


  </script>



  <script src="glidepath.js"></script>
  <script src="percentallocations.js"></script>

</body>



</html>